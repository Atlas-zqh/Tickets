<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>订单详情</title>

    <link th:href="@{~/css/bootstrap.min.css}" rel="stylesheet"/>
    <link th:href="@{~/css/fixed-footer.css}" type="text/css" rel="stylesheet"/>
    <link th:href="@{~/css/text-hidden.css}" type="text/css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{~/css/toastr.css}"/>

    <script th:src="@{~/js/html5shiv.min.js}"></script>
    <script th:src="@{~/js/respond.min.js}"></script>
    <script th:src="@{~/js/jquery.js}"></script>
    <script th:src="@{~/js/bootstrap.min.js}"></script>
    <script th:src="@{~/js/toastr.min.js}"></script>
</head>
<body>
<div th:replace="common/nav :: nav"></div>

<div class="container">
    <div style="font-size: larger;padding-top: 5%">
        <span class="glyphicon glyphicon-triangle-right" aria-hidden="true" style="color: #116e8a"></span>
        <span class="active" style="color: #349dbd">订单信息</span>
    </div>

    <div class="row" style="padding-top: 1%">
        <div class="col-sm-3">
            <form class="form-horizontal">
                <div class="form-group">
                    <label class="col-sm-4 control-label">订单号</label>
                    <div class="col-sm-8">
                        <p class="form-control-static" th:text="${detailBean.ticketNumber}"></p>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-4 control-label">订单类型</label>
                    <div class="col-sm-8">
                        <p class="form-control-static" th:text="${detailBean.orderType}"></p>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-4 control-label">积分奖励</label>
                    <div class="col-sm-8">
                        <p class="form-control-static" th:text="${detailBean.orderPrice}+'分'"></p>
                    </div>
                </div>
            </form>
        </div>
        <div class="col-sm-3">
            <form class="form-horizontal">
                <div class="form-group">
                    <label class="col-sm-4 control-label">用户邮箱</label>
                    <div class="col-sm-8">
                        <p class="form-control-static" th:text="${detailBean.userEmail}"></p>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-4 control-label">下单时间</label>
                    <div class="col-sm-8">
                        <p class="form-control-static" th:text="${detailBean.createOrderTime}"></p>
                    </div>
                </div>
            </form>
        </div>
        <div class="col-sm-3">
            <form class="form-horizontal">
                <div class="form-group">
                    <label class="col-sm-4 control-label">活动名称</label>
                    <div class="col-sm-8">
                        <p class="form-control-static text-hidden" th:text="${detailBean.showName}"></p>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-4 control-label">付款时间</label>
                    <div class="col-sm-8">
                        <p class="form-control-static" th:text="${detailBean.payTime}"></p>
                    </div>
                </div>
            </form>
        </div>
        <div class="col-sm-3">
            <form class="form-horizontal">
                <div class="form-group">
                    <label class="col-sm-4 control-label">订单金额</label>
                    <div class="col-sm-8">
                        <p class="form-control-static" th:text="${detailBean.orderPrice}+'元'"></p>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-4 control-label">订单状态</label>
                    <div class="col-sm-8">
                        <p class="form-control-static" th:text="${detailBean.orderStatus}"></p>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>


<div class="container">
    <div style="font-size: larger;padding-top: 5%">
        <span class="glyphicon glyphicon-triangle-right" aria-hidden="true" style="color: #116e8a"></span>
        <span class="active" style="color: #349dbd">活动信息</span>
    </div>

    <div class="row" style="padding-top: 2%">
        <div class="col-xs-8 col-sm-8" style="padding-left: 3%">
            <form class="form-horizontal">
                <div class="form-group">
                    <h4 class="col-sm-12" th:text="${detailBean.showName}"></h4>
                </div>
                <div>
                    <div class="form-group">
                        <label class="col-sm-2">开始时间</label>
                        <div class="col-sm-10">
                            <p th:text="${detailBean.startTime}"></p>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-sm-2">结束时间</label>
                        <div class="col-sm-10">
                            <p th:text="${detailBean.endTime}"></p>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2">地址</label>
                        <div class="col-sm-10">
                            <p th:text="${detailBean.address}"></p>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-sm-2">类型</label>
                        <div class="col-sm-10">
                            <p th:text="${detailBean.showPlanType}"></p>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-sm-2">座位</label>
                        <div class="col-sm-10">
                            <p th:text="${detailBean.seats}"></p>
                        </div>
                    </div>
                </div>

            </form>
        </div>
    </div>
</div>

<div class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" id="refundModal">
    <div class="modal-dialog modal-sm" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">确定要申请退款吗？</h4>
            </div>
            <div class="modal-footer">
                <a class="btn btn-default" th:onclick="'javascript:refund('+${detailBean.orderId}+')'">确定</a>
                <a class="btn btn-primary" data-dismiss="modal">取消</a>
            </div>
        </div>
    </div>
</div>

<div class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" id="cancelModal">
    <div class="modal-dialog modal-sm" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">确定要取消订单吗？</h4>
            </div>
            <div class="modal-footer">
                <a class="btn btn-default" th:onclick="'javascript:cancelOrder('+${detailBean.orderId}+')'">确定</a>
                <a class="btn btn-primary" data-dismiss="modal">取消</a>
            </div>
        </div>
    </div>
</div>

<div class="container" style="text-align: center;margin-top: 5%">
    <a class="btn btn-default" href="eventDetail.html">活动详情</a>
    <a class="btn btn-default" th:href="@{'/user/paying?orderId='+${detailBean.orderId}}" th:if="${detailBean.showPay}">前往支付</a>
    <a class="btn btn-default" href="#" th:if="${detailBean.showReturn}" data-toggle="modal" data-target="#refundModal">申请退款</a>
    <a class="btn btn-default" href="#" th:if="${detailBean.showCancel}" data-toggle="modal" data-target="#cancelModal">取消订单</a>
</div>

<script th:inline="javascript">
    toastr.options = {
        closeButton: false,
        debug: false,
        progressBar: true,
        positionClass: "toast-top-center",
        onclick: null,
        showDuration: "300",
        hideDuration: "1000",
        timeOut: "3000",
        extendedTimeOut: "1000",
        showEasing: "swing",
        hideEasing: "linear",
        showMethod: "fadeIn",
        hideMethod: "fadeOut"
    };

    function refund(orderId) {
        $.ajax({
            url: '/user/refund.action',
            type: 'POST',
            contentType: 'application/json',
            dataType: 'json',
            data: {orderId: orderId},
            success: function (data) {
                if (data.resultCode === 'error') {
                    toastr.warning(data.resultMessage)
                } else {
                    toastr.success('退款成功')
                    window.location.href = '/user/orders'
                }
            }
        })
    }

    function cancelOrder(orderId) {
        $.ajax({
            url: '/user/cancelOrder.action',
            type: 'POST',
            contentType: 'application/json',
            dataType: 'json',
            data: {orderId: orderId},
            success: function (data) {
                if (data.resultCode === 'error') {
                    toastr.warning(data.resultMessage)
                } else {
                    toastr.success('取消成功')
                    window.location.href = '/user/orders'
                }
            }
        })
    }
</script>
<footer class="panel-footer">
    <div class="container" style="text-align: center">
        © 2018 | Created by <a href="https://atlas-zqh.github.io/">Keenan</a>. All rights reserved. | Content by <a
            href="http://www.douban.com/location/">豆瓣同城</a>
    </div>
</footer>

</body>
</html>