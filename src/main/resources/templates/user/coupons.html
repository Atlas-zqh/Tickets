<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>我的优惠</title>

    <link th:href="@{~/css/bootstrap.min.css}" rel="stylesheet"/>
    <link th:href="@{~/css/fixed-footer.css}" type="text/css" rel="stylesheet"/>
    <link rel="stylesheet" th:href="@{~/css/toastr.css}"/>

    <script th:src="@{~/js/html5shiv.min.js}"></script>
    <script th:src="@{~/js/respond.min.js}"></script>
    <script th:src="@{~/js/jquery.js}"></script>
    <script th:src="@{~/js/bootstrap.min.js}"></script>
    <script th:src="@{~/js/toastr.min.js}"></script>

</head>
<body>
<div th:replace="common/nav :: nav"></div>

<div class="container">
    <div style="font-size: larger;padding-top: 2%">
        <span class="glyphicon glyphicon-triangle-right" aria-hidden="true" style="color: #116e8a"></span>
        <span class="active" style="color: #349dbd">我的可用优惠</span>
    </div>

    <div class="row" style="padding-top: 1%">
        <div th:each="myCoupon :${myCoupons}" class="col-sm-3 col-xs-3">
            <div th:class="${myCoupon.userCouponId==0}?'panel panel-primary':'panel panel-info'">
                <div class="panel-heading">
                    <h3 class="panel-title" th:text="${myCoupon.couponName}"></h3>
                </div>
                <div class="panel-body">
                    <label>优惠额度：</label><span th:text="${myCoupon.discount*10}"></span>折
                    <br>
                    <label>有效期至：</label><span th:text="${myCoupon.expireDate}"></span>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <div style="font-size: larger;padding-top: 1%">
        <span class="glyphicon glyphicon-triangle-right" aria-hidden="true" style="color: #116e8a"></span>
        <span class="active" style="color: #349dbd">优惠券商城</span>
        <span class="active" style="color: #349dbd;float: right" th:text="'剩余积分：'+${remainPoints}"></span>

    </div>

    <div class="row" style="padding-top: 1%">
        <div class="col-sm-3 col-xs-3" th:each="coupon:${couponMarket}">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title"><span th:text="${coupon.couponName}"></span>
                        <button class="btn btn-info btn-xs" style="float: right;" th:onclick="'javascript:changeCoupon('+${coupon.userCouponId}+')'">兑换</button>
                    </h3>
                </div>
                <div class="panel-body">
                    <label>优惠额度：</label><span th:text="${coupon.discount*10}"></span>折
                    <br>
                    <label>有效期至：</label><span th:text="${coupon.expireDate}"></span>
                    <br>
                    <label>所需积分：</label><span th:text="${coupon.requirePoints}"></span>
                </div>
            </div>
        </div>
    </div>
</div>

<script th:inline="javascript">
    toastr.options = {
        closeButton: false,
        debug: false,
        progressBar: true,
        positionClass: "toast-top-center",
        onclick: null,
        showDuration: "300",
        hideDuration: "1000",
        timeOut: "3000",
        extendedTimeOut: "1000",
        showEasing: "swing",
        hideEasing: "linear",
        showMethod: "fadeIn",
        hideMethod: "fadeOut"
    };

    function changeCoupon(couponId) {
        $.ajax({
            type: 'POST',
            url: '/user/changeCoupon.action',
            contentType: 'application/json',
            dataType: 'json',
            data: {couponId: couponId},
            success: function (data) {
                if (data.resultCode === 'error') {
                    toastr.warning(data.resultMessage)
                } else {
                    window.location.href = '/user/coupons'
                }
            }
        })
    }
</script>
<footer class="panel-footer">
    <div class="container" style="text-align: center">
        © 2018 | Created by <a href="https://atlas-zqh.github.io/">Keenan</a>. All rights reserved. | Content by <a
            href="http://www.douban.com/location/">豆瓣同城</a>
    </div>
</footer>

</body>
</html>