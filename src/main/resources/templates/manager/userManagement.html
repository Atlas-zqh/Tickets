<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>用户管理</title>

    <link th:href="@{~/css/bootstrap.min.css}" rel="stylesheet"/>
    <link th:href="@{~/css/fixed-footer.css}" type="text/css" rel="stylesheet"/>
    <link rel="stylesheet" th:href="@{~/css/toastr.css}"/>
    <script th:src="@{~/js/html5shiv.min.js}"></script>
    <script th:src="@{~/js/respond.min.js}"></script>
    <script th:src="@{~/js/jquery.js}"></script>
    <script th:src="@{~/js/bootstrap.min.js}"></script>
    <script th:src="@{~/js/toastr.min.js}"></script>
</head>
<body>
<div th:replace="common/adminNav :: adminNav"></div>

<div class="container">
    <div style="font-size: larger;padding-top: 2%;padding-bottom: 1%">
        <span class="glyphicon glyphicon-triangle-right" aria-hidden="true" style="color: #116e8a"></span>
        <span class="active" style="color: #349dbd">用户管理</span>
    </div>

    <table class="table">
        <tr>
            <th>用户名</th>
            <th>用户邮箱</th>
            <th>操作</th>
        </tr>

        <tr th:each="userBrief: ${userBriefs}">
            <td th:text="${userBrief.username}"></td>
            <td th:text="${userBrief.email}"></td>
            <td>
                <button th:id="'blockId'+${userBrief.userId}" th:if="${userBrief.isValid}"
                        class="btn btn-default btn-xs"
                        th:onclick="'javascript:blockUser('+${userBrief.userId}+')'">
                    封号
                </button>
                <button th:id="'unblockId'+${userBrief.userId}" th:unless="${userBrief.isValid}"
                        class="btn btn-info btn-xs"
                        th:onclick="'javascript:unBlockUser('+${userBrief.userId}+')'">
                    解封
                </button>
            </td>
        </tr>

    </table>
</div>

<script th:inline="javascript">
    toastr.options = {
        closeButton: false,
        debug: false,
        progressBar: true,
        positionClass: "toast-top-center",
        onclick: null,
        showDuration: "300",
        hideDuration: "1000",
        timeOut: "3000",
        extendedTimeOut: "1000",
        showEasing: "swing",
        hideEasing: "linear",
        showMethod: "fadeIn",
        hideMethod: "fadeOut"
    };


    function blockUser(userId) {
        $.ajax({
            type: 'POST',
            url: '/admin/block.action',
            contentType: 'application/json',
            dataType: 'json',
            data: {userId: userId},
            success: function (data) {
                if (data.resultCode === 'error') {
                    toastr.warning(data.resultMessage)
                } else {
                    $('#blockId' + userId).css('display', 'none')
                    $('#unblockId' + userId).css('display', 'block')
                    // toastr.success(data.resultMessage)
                    window.location.href='/admin/userManage'
                }
            }
        })
    };

    function unBlockUser(userId) {
        $.ajax({
            type: 'POST',
            url: '/admin/unblock.action',
            contentType: 'application/json',
            dataType: 'json',
            data: {userId: userId},
            success: function (data) {
                if (data.resultCode === 'error') {
                    toastr.warning(data.resultMessage)
                } else {
                    $('#unblockId' + userId).css('display', 'none')
                    $('#blockId' + userId).css('display', 'block')
                    window.location.href='/admin/userManage'
                }
            }
        })
    }
</script>


<footer class="panel-footer">
    <div class="container" style="text-align: center">
        © 2018 | Created by <a href="https://atlas-zqh.github.io/">Keenan</a>. All rights reserved. | Content by <a
            href="http://www.douban.com/location/">豆瓣同城</a>
    </div>
</footer>

</body>
</html>